{
   "supersourceName":"supersource_bedrock_order_fact_business_logic",
   "mapping":[
      {
         "sourceName":"commerce.eg_commerce_bookingitem_event_v1",
         "type":"fact",
         "attributes":[
            {
               "attributeName":"begin_use_date",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"end_use_date",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"duration",
               "derivationType":"derived",
               "filterExpression":null,
               "alias":null,
               "calculation":"datediff(commerce.eg_commerce_bookingitem_event_v1.end_use_date , commerce.eg_commerce_bookingitem_event_v1.begin_use_date)",
               "joinInfo":null,
               "dataType":null,
               "description":"duration between trip begin date and trip end date"
            },
            {
               "attributeName":"booking_event_date_utc",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"booking_event_datetime_utc",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"business_model_name",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"booking_item_id",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"booking_record_locator",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"travel_product_id",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"lob_subunit_cnt",
               "derivationType":"derived",
               "filterExpression":null,
               "alias":null,
               "calculation":"case  when commerce.eg_commerce_bookingitem_event_v1.line_of_business = 'Car' then commerce.eg_commerce_bookingitem_event_v1.rental_day_count when commerce.eg_commerce_bookingitem_event_v1.line_of_business = 'Air' then  commerce.eg_commerce_bookingitem_event_v1.ticket_count when commerce.eg_commerce_bookingitem_event_v1.line_of_business = 'Lodging' then  commerce.eg_commerce_bookingitem_event_v1.room_night_count when commerce.eg_commerce_bookingitem_event_v1.line_of_business = 'Insurance' then 1 END",
               "joinInfo":null,
               "dataType":null,
               "description":"lob_subunit_cnt"
            },
            {
               "attributeName":"gross_booking_amount_usd",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"margin_amount_usd",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"order_id",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"point_of_sale_order_reference_number",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"book_date_utc",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"purchase_online_offline_indicator",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"LOB_SUBUNIT_CNT_PURCHASE",
               "derivationType":"derived",
               "filterExpression":null,
               "alias":null,
               "calculation":"case when commerce.eg_commerce_bookingitem_event_v1.event_type_name like '%Purchased%' or commerce.eg_commerce_bookingitem_event_v1.event_type_name like '%Rebooked%'  then (case  when commerce.eg_commerce_bookingitem_event_v1.line_of_business = 'Car' then commerce.eg_commerce_bookingitem_event_v1.rental_day_count when commerce.eg_commerce_bookingitem_event_v1.line_of_business = 'Air' then  commerce.eg_commerce_bookingitem_event_v1.ticket_count when commerce.eg_commerce_bookingitem_event_v1.line_of_business = 'Lodging' then commerce.eg_commerce_bookingitem_event_v1.room_night_count when commerce.eg_commerce_bookingitem_event_v1.line_of_business = 'Insurance' then 1 END) ELSE 0 END ",
               "joinInfo":null,
               "dataType":null,
               "description":"duration"
            },
            {
               "attributeName":"LOB_SUBUNIT_CNT_CANCEL",
               "derivationType":"derived",
               "filterExpression":null,
               "alias":null,
               "calculation":"case when commerce.eg_commerce_bookingitem_event_v1.event_type_name like '%Canceled%'   then (case  when commerce.eg_commerce_bookingitem_event_v1.line_of_business = 'Car' then commerce.eg_commerce_bookingitem_event_v1.rental_day_count when commerce.eg_commerce_bookingitem_event_v1.line_of_business = 'Air' then  commerce.eg_commerce_bookingitem_event_v1.ticket_count when commerce.eg_commerce_bookingitem_event_v1.line_of_business = 'Lodging' then commerce.eg_commerce_bookingitem_event_v1.room_night_count when commerce.eg_commerce_bookingitem_event_v1.line_of_business = 'Insurance' then 1 END) ELSE 0 END ",
               "joinInfo":null,
               "dataType":null,
               "description":"LOB_SUBUNIT_CNT_CANCEL"
            },
            {
               "attributeName":"GROSS_BOOKING_AMOUNT_USD_PURCHASE",
               "derivationType":"derived",
               "filterExpression":null,
               "alias":null,
               "calculation":"case when commerce.eg_commerce_bookingitem_event_v1.event_type_name like '%Purchased%' or commerce.eg_commerce_bookingitem_event_v1.event_type_name like '%Rebooked%' then commerce.eg_commerce_bookingitem_event_v1.GROSS_BOOKING_AMOUNT_USD ELSE 0 END",
               "joinInfo":null,
               "dataType":null,
               "description":"GROSS_BOOKING_AMOUNT_USD_PURCHASE"
            },
            {
               "attributeName":"GROSS_BOOKING_AMOUNT_USD_CANCEL",
               "derivationType":"derived",
               "filterExpression":null,
               "alias":null,
               "calculation":"case when commerce.eg_commerce_bookingitem_event_v1.event_type_name like '%Canceled%'  then commerce.eg_commerce_bookingitem_event_v1.GROSS_BOOKING_AMOUNT_USD ELSE 0 END",
               "joinInfo":null,
               "dataType":null,
               "description":"GROSS_BOOKING_AMOUNT_USD_CANCEL"
            },
            {
               "attributeName":"GROSS_BOOKING_AMOUNT_USD_MODIFICATION",
               "derivationType":"derived",
               "filterExpression":null,
               "alias":null,
               "calculation":"case when commerce.eg_commerce_bookingitem_event_v1.event_type_name like '%Changed%' or  commerce.eg_commerce_bookingitem_event_v1.event_type_name like '%Updated%' or commerce.eg_commerce_bookingitem_event_v1.event_type_name like '%Adjusted%' then commerce.eg_commerce_bookingitem_event_v1.GROSS_BOOKING_AMOUNT_USD ELSE 0 END",
               "joinInfo":null,
               "dataType":null,
               "description":"GROSS_BOOKING_AMOUNT_USD_MODIFICATION"
            },
            {
               "attributeName":"advance_purchase_day_count",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"eg_brand_name",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"line_of_business",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"payment_list",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"event_type_name",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"package_indicator",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"management_unit_code",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            }
         ]
      },
      {
         "sourceName":"commerce.eg_country",
         "type":"dimension",
         "attributes":[
            {
               "attributeName":"country_code",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":{
                  "joinTo":"commerce.eg_commerce_bookingitem_event_v1",
                  "joinToCol":"Jurisdiction_code",
                  "joinType":"left"
               },
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"country_name",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"short_country_code",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            }
         ]
      },
      {
         "sourceName":"commerce.eg_date_dimension",
         "type":"dimension",
         "attributes":[
            {
               "attributeName":"actual_date",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":{
                  "joinTo":"commerce.eg_commerce_bookingitem_event_v1",
                  "joinToCol":"booking_event_date_utc",
                  "joinType":"inner"
               },
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"wk_nbr_in_year",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"month_nbr_in_year",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"qtr_nbr_in_year",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"year_nbr",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            }
         ]
      },
      {
         "sourceName":"dspprod_eps_common.EPS_MGMT_UNIT_DIM",
         "type":"dimension",
         "attributes":[
            {
               "attributeName":"mgmt_unit_code",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":{
                  "joinTo":"commerce.eg_commerce_bookingitem_event_v1",
                  "joinToCol":"management_unit_code",
                  "joinType":"left"
               },
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"mgmt_unit_lvl_8_name",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"mgmt_unit_lvl_4_name",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            },
            {
               "attributeName":"EPS_DIVISION",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":null
            }
         ]
      },
      {
         "sourceName":"supply.lodging_profile_eg",
         "type":"dimension",
         "attributes":[
            {
               "attributeName":"EXPE_PROPERTY_ID",
               "derivationType":"derived",
               "filterExpression":null,
               "alias":null,
               "calculation":"coalesce(supply.lodging_profile_eg.vrbo_property_id, supply.lodging_profile_eg.eg_property_id)",
               "joinInfo":{
                  "joinTo":"commerce.eg_commerce_bookingitem_event_v1",
                  "joinToCol":"property_id",
                  "joinType":"left"
               },
               "dataType":null,
               "description":"EXPE_PROPERTY_ID"
            },
            {
               "attributeName":"property_name",
               "derivationType":"straight_pull",
               "filterExpression":null,
               "alias":null,
               "calculation":null,
               "joinInfo":null,
               "dataType":null,
               "description":"property_name"
            }
         ]
      },
      {
         "sourceName":null,
         "type":"cross-source",
         "attributes":[
            {
               "attributeName":"EPS_GBV_OWNER",
               "derivationType":"derived",
               "filterExpression":null,
               "alias":null,
               "source":null,
               "calculation":"CASE WHEN commerce.eg_commerce_bookingitem_event_v1.package_indicator = 'Standalone' and dspprod_eps_common.EPS_MGMT_UNIT_DIM.mgmt_unit_lvl_8_name = 'Amex' THEN  'AMEX' ELSE dspprod_eps_common.EPS_MGMT_UNIT_DIM.mgmt_unit_lvl_4_name END",
               "joinInfo":null,
               "dataType":null,
               "description":"EPS_GBV_OWNER"
            }
         ]
      }
   ],
   "status":"created",
   "createDate":"timestamp",
   "updateDate":"timestamp",
   "updateRunId":"job_id",
   "updatedBy":"process_name",
   "version":"1.0",
   "datePartition":null,
   "processQuery":null
}